<!-- Page content -->
<div class="ui container main">
  <h2 class="ui left floated inverted header">{{ lang.tasks.title }}</h2>

  <table class="ui single line selectable inverted fixed sortable unstackable table tasks-table">
    <thead>
      <tr>
        <th class="three wide">{{ lang.tasks.name }}</th>
        <th class="three wide">{{ lang.tasks.category }}</th>
        <th class="eight wide">{{ lang.tasks.desc }}</th>
        <th class="two wide center aligned"><i class="settings icon"></i></th>
      </tr>
    </thead>
    <tbody>
      {% for task in tasks %}
      <tr>
        <td class="three wide">{{ task.name }}</td>
        <td class="three wide">{{ categories[task.category-1].name }}</td>
        <td class="eight wide">{{ task.desc }}</td>
        <td class="two wide center aligned">
          <a href="#" data-id="1"><i class="large edit icon task-edit"></i></a>
          <a href="#"><i class="large trash icon task-delete"></i></a>
        </td>
      </tr>
      {% endfor %}
    </tbody>
    <tfoot class="full-width">
      <tr>
        <th colspan="4">
          <div class="ui right floated">
            <button class="ui right floated small primary labeled icon button" onclick="$('.task-new-modal').modal('show')">
              <i class="plus icon"></i>{{ lang.tasks.add }}
            </button>
        </th>
    </tfoot>
  </table>
</div>

<div class="ui modal task-delete-modal">
  <div class="header">{{ lang.tasks.delete }}</div>

  <div class="content">
    <div class="ui form">
      <div class="field">
        <label>{{ lang.tasks.name }}</label>
        <input type="text" name="task-name" value="Task name" disabled>
      </div>
      <div class="field">
        <label>{{ lang.tasks.category }}</label>
        <input type="text" name="task-category" value="Task category" disabled>
      </div>
      <div class="field">
        <label>{{ lang.tasks.desc }}</label>
        <textarea rows="3" disabled>Task description</textarea>
      </div>

      <div class="field">
        <label>{{ lang.tasks.hint }}</label>
        <textarea rows="2" disabled>Task hint</textarea>
      </div>

      <div class="field">
        <label>{{ lang.tasks.file }}</label>
        <input type="text" name="task-file" value="Task file" disabled>
      </div>

      <div class="field">
        <label>{{ lang.tasks.flag }}</label>
        <input type="text" name="task-file" value="Task flag" disabled>
      </div>
    </div>
  </div>

  <div class="actions">
    <div class="ui black cancel button">{{ lang.tasks.delete_cancel }}</div>
    <div class="ui negative right labeled icon button">
      {{ lang.tasks.delete_accept }}
      <i class="trash icon"></i>
    </div>
  </div>
</div>

<form class="ui modal task-edit-modal">
  <div class="header">{{ lang.tasks.edit }}</div>
  <div class="content">
    <div class="ui form">
      <div class="field">
        <label>{{ lang.tasks.name }}</label>
        <input type="text" name="task-name" placeholder="{{ lang.tasks.name_placeholder }}">
      </div>
      <div class="field">
        <label>{{ lang.tasks.category }}</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="task-category">
          <i class="dropdown icon"></i>
          <div class="default text">{{ lang.tasks.category_placeholder }}</div>
          <div class="menu">
            {% for category in categories %}
            <div class="item" data-value="{{ category.id }}">{{ category.name }}</div>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="field">
        <label>{{ lang.tasks.desc }}</label>
        <textarea rows="3" placeholder="{{ lang.tasks.desc_placeholder }}"></textarea>
      </div>

      <div class="field">
        <label>{{ lang.tasks.hint }}</label>
        <textarea rows="2" placeholder="{{ lang.tasks.hint_placeholder }}"></textarea>
      </div>

      <div class="field">
        <label>{{ lang.tasks.file }}</label>
        <div class="ui left action input">
          <label for="attachmentName" class="ui labeled icon button btn-file">
            <i class="attachment upload icon"></i>
            {{ lang.tasks.file_placeholder }}
            <input type="file" id="attachmentName" name="attachmentName" style="display: none">
          </label>
          <input type="text" id="_attachmentName" disabled>
        </div>
      </div>

      <div class="field">
        <label>{{ lang.tasks.flag }}</label>
        <input type="text" name="task-flag" placeholder="{{ lang.tasks.flag_placeholder }}">
      </div>

    </div>
  </div>

  <div class="actions">
    <div class="ui black cancel button">{{ lang.tasks.edit_cancel }}</div>
    <div class="ui positive right labeled icon ok button">
      {{ lang.tasks.edit_accept }}
      <i class="checkmark icon"></i>
    </div>
  </div>
</form>

<form class="ui modal task-new-modal">
  <div class="header">{{ lang.tasks.new }}</div>
  <div class="content">
    <div class="ui form">

      <div class="field">
        <label>{{ lang.tasks.name }}</label>
        <input type="text" name="task-name" placeholder="{{ lang.tasks.name_placeholder }}">
      </div>
      <div class="field">
        <label>{{ lang.tasks.category }}</label>
        <div class="ui fluid search selection dropdown">
          <input type="hidden" name="task-category">
          <i class="dropdown icon"></i>
          <div class="default text">{{ lang.tasks.category_placeholder }}</div>
          <div class="menu">
            {% for category in categories %}
            <div class="item" data-value="{{ category.id }}">{{ category.name }}</div>
            {% endfor %}
          </div>
        </div>
      </div>
      <div class="field">
        <label>{{ lang.tasks.desc }}</label>
        <textarea rows="3" placeholder="{{ lang.tasks.desc_placeholder }}"></textarea>
      </div>

      <div class="field">
        <label>{{ lang.tasks.hint }}</label>
        <textarea rows="2" placeholder="{{ lang.tasks.hint_placeholder }}"></textarea>
      </div>

      <div class="field">
        <label>{{ lang.tasks.file }}</label>
        <div class="ui left action input">
          <label for="attachmentName" class="ui labeled icon button btn-file">
            <i class="attachment upload icon"></i>
            {{ lang.tasks.file_placeholder }}
            <input type="file" id="attachmentName" name="attachmentName" style="display: none">
          </label>
          <input type="text" id="_attachmentName" disabled>
        </div>
      </div>

      <div class="field">
        <label>{{ lang.tasks.flag }}</label>
        <input type="text" name="task-flag" placeholder="{{ lang.tasks.flag_placeholder }}">
      </div>

    </div>
  </div>

  <div class="actions">
    <div class="ui black cancel button">{{ lang.tasks.new_cancel }}</div>
    <div class="ui positive right labeled icon ok button">
      {{ lang.tasks.new_accept }}
      <i class="checkmark icon"></i>
    </div>
  </div>
</form>

<script>
$(function() {
  $('.tasks-table').tablesort()
  $('.ui.dropdown').dropdown()

  $('.task-edit').on('click', function() {
    $('.task-loading').addClass('active');

    //$(this).data("id");
    // Fetch

    $('.task-loading').removeClass('active');

    $('.task-edit-modal').modal('show');
  });

  $('.task-delete').on('click', function() {
    $('.task-loading').addClass('active');

    //$(this).data("id");
    // Fetch

    $('.task-loading').removeClass('active');

    $('.task-delete-modal').modal('show');
  });
});
</script>

<script>

var MAX_SIZE = 30; // MB

$(document).on('change', '.btn-file :file', function() {
  var input = $(this);

  if (navigator.appVersion.indexOf("MSIE") != -1) { // IE
    var label = input.val();

    input.trigger('fileselect', [ 1, label, 0 ]);
  } else {
    var label = input.val().replace(/\\/g, '/').replace(/.*\//, '');
    var numFiles = input.get(0).files ? input.get(0).files.length : 1;
    var size = input.get(0).files[0].size;

    input.trigger('fileselect', [ numFiles, label, size ]);
  }
});

$('.btn-file :file').on('fileselect', function(event, numFiles, label, size) {
  console.log("ok!");
  $('#attachmentName').attr('name', 'attachmentName'); // allow upload.

  if (size > 1024 * 1024 * MAX_SIZE ) {
    alert('max sizeï¼š<strong>' + MAX_SIZE + '</strong> MB.');

    $('#attachmentName').removeAttr('name'); // cancel upload file.
  } else {
    $('#_attachmentName').val(label);
  }
});

</script>
